<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="mini_pi">
  
  <!-- Global Material Definitions -->
  <material name="Red">
    <color rgba="1.0 0.0 0.0 1.0"/>
  </material>

  <material name="Gray">
    <color rgba="0.6 0.6 0.6 1"/>
  </material>

  <material name="Blue">
    <color rgba="0.3 0.5 1.0 1.0"/>
  </material>

  <material name="Black">
    <color rgba="0.0 0.0 0.0 1.0"/>
  </material>

  <material name="Green">
    <color rgba="0.0 1.0 0.0 1.0"/>
  </material>

  <material name="Yellow">
    <color rgba="1.0 0.9 0.0 1.0"/>
  </material>

  <material name="Orange">
    <color rgba="1.0 0.5 0 0.8"/>
  </material>
  
  <material name="Pink">
    <color rgba="0.8 0.4 1.0 1.0"/>
  </material>
  
  <!-- Properties -->
  <xacro:property name="base_size_x" value="0.097"/>
  <xacro:property name="base_size_y" value="0.097"/>
  <xacro:property name="base_size_z" value="0.097"/>
  <xacro:property name="base_mass" value="1.0"/>
  <xacro:property name="wheel_radius" value="0.03"/>
  <xacro:property name="wheel_width" value="0.02"/>
  <xacro:property name="wheel_mass" value="0.05"/>
  <xacro:property name="ultrasonic_x" value="0.02"/>
  <xacro:property name="ultrasonic_y" value="0.02"/>
  <xacro:property name="ultrasonic_z" value="0.01"/>
  
  <!-- ==== Macros ==== -->
  <!-- ===== Macros for squared component ==== -->
  <xacro:macro name="square_link" params="name size_x size_y size_z material mass parent_link xyz rpy joint_type">
    <!-- Squared link -->
    <link name="${name}">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <box size="${size_x} ${size_y} ${size_z}"/>
        </geometry>
        <material name="${material}"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <box size="${size_x} ${size_y} ${size_z}"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="${mass}" />
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia 
          ixx="${(1/12.0)*mass*(size_y*size_y + size_z*size_z)}"
          ixy="0.0"
          ixz="0.0"
          iyy="${(1/12.0)*mass*(size_x*size_x + size_z*size_z)}"
          iyz="0.0"
          izz="${(1/12.0)*mass*(size_x*size_x + size_y*size_y)}" />
      </inertial>
    </link>
    <!-- Squared joint -->    
    <joint name="${name}_joint" type="${joint_type}">
      <origin xyz="${xyz}" rpy="${rpy}"/>
      <parent link="${parent_link}"/>
      <child link="${name}"/>
      <xacro:if value="${joint_type != 'fixed'}">
        <axis xyz="0 0 1"/>
      </xacro:if>
    </joint>
  </xacro:macro>

  <!-- ==== Macro for Cylindrical Component ==== -->
  <xacro:macro name="cylinder_link" params="name radius length material mass parent_link xyz rpy joint_type axis">
    <link name="${name}">
      <visual>
        <origin xyz="0 0 0" rpy="1.5708 0 0" />
        <geometry>
          <cylinder radius="${radius}" length="${length}" />
        </geometry>
        <material name="${material}">
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="1.5708 0 0" />
        <geometry>
          <cylinder radius="${radius}" length="${length}" />
        </geometry>
      </collision>
      <inertial>
        <mass value="${mass}" />
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="${(1.0/12.0)*mass*(3.0*(radius*radius) + (length*length))}"
                 ixy="0" 
                 ixz="0" 
                 iyy="${(1.0/2.0) *mass*(radius*radius)}"
                 iyz="0"
                 izz="${(1.0/12.0)*mass*(3.0*(radius*radius) + (length*length))}"/>
      </inertial>
    </link>
    <!-- Cylinder joint -->
    <joint name="${name}_joint" type="${joint_type}">
      <origin xyz="${xyz}" rpy="${rpy}"/>
      <parent link="${parent_link}" />
      <child link="${name}" />
      <axis xyz="${axis}" />
    </joint>
  </xacro:macro>

  <!-- ==== Macro for Caster Wheel ==== -->
  <xacro:macro name="caster_wheel" params="name pos_x pos_y pos_z color_yaw color_pitch color_roll parent_link mass radius length">
    <!-- Caster Wheel Link (Yaw) -->
    <link name="${name}_yaw_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <cylinder length="${length}" radius="${radius}"/>
        </geometry>
        <material name="${color_yaw}"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <cylinder length="${length}" radius="${radius}"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${mass}"/>
        <inertia
          ixx="${(1.0/4.0) * mass * (radius * radius) + (1.0/12.0) * mass * (length * length)}"
          ixy="0.0"
          ixz="0.0"
          iyy="${(1.0/4.0) * mass * (radius * radius) + (1.0/12.0) * mass * (length * length)}"
          iyz="0.0"
          izz="${(1.0/2.0) * mass * (radius * radius)}"/>
      </inertial>
    </link>
    <!-- Yaw Joint -->
    <joint name="${name}_yaw_joint" type="continuous">
      <origin rpy="0 0 0" xyz="${pos_x} ${pos_y} ${pos_z}" />
      <parent link="${parent_link}"/>
      <child link="${name}_yaw_link"/>
      <axis xyz="0 0 1"/>
    </joint>

    <!-- Caster Wheel Link (Roll) -->
    <link name="${name}_roll_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 1.5708 0"/>
        <geometry>
          <cylinder length="${length}" radius="${radius}"/>
        </geometry>
        <material name="${color_roll}"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 1.5708 0"/>
        <geometry>
          <cylinder length="${length}" radius="${radius}"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 1.5708 0"/>
        <mass value="${mass}"/>
        <inertia
          ixx="${(1.0/4.0) * mass * (radius * radius) + (1.0/12.0) * mass * (length * length)}"
          ixy="0.0"
          ixz="0.0"
          iyy="${(1.0/4.0) * mass * (radius * radius) + (1.0/12.0) * mass * (length * length)}"
          iyz="0.0"
          izz="${(1.0/2.0) * mass * (radius * radius)}"/>
      </inertial>
    </link>
    <!-- Roll Joint -->
    <joint name="${name}_roll_joint" type="continuous">
      <origin rpy="0 0 0" xyz="0 0 0" />
      <parent link="${name}_yaw_link"/>
      <child link="${name}_roll_link"/>
      <axis xyz="1 0 0"/>
    </joint>

    <!-- Caster Wheel Link (Pitch) -->
    <link name="${name}_pitch_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <sphere radius="${radius}" />
        </geometry>
        <material name="${color_pitch}"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <sphere radius="${radius}"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${mass}"/>
        <inertia 
          ixx="${(2.0/5.0) * mass * (radius * radius)}"
          ixy="0.0"
          ixz="0.0"
          iyy="${(2.0/5.0) * mass * (radius * radius)}"
          iyz="0.0"
          izz="${(2.0/5.0) * mass * (radius * radius)}"/>
      </inertial>
    </link>
    <!-- Roll Joint -->
    <joint name="${name}_pitch_joint" type="continuous">
      <origin rpy="0 0 0" xyz="0 0 0" />
      <parent link="${name}_roll_link"/>
      <child link="${name}_pitch_link"/>
      <axis xyz="0 1 0"/>
    </joint>
  </xacro:macro>


  <!-- ======================= -->
  <!-- =     Robot Model     = -->
  <!-- ======================= -->
  <link name="base_footprint"/>
  <joint name="footprint_to_base" type="fixed">
    <parent link="base_footprint"/>
    <child  link="base_link"/>
    <origin xyz="0 0 0.0585" rpy="0 0 0"/>
  </joint>

  <!-- Define the base link-->
  <link name="base_link">
    <!-- Placeholder for base_link; no geometry or inertial properties defined -->
  </link>
  
  <!-- ==== Create Chassis ====  -->
  <xacro:square_link 
    name="chassis"
    size_x="${base_size_x}"
    size_y="${base_size_y}"
    size_z="${base_size_z}"
    material="Red"
    mass="${base_mass}"
    parent_link="base_link"
    xyz="0 0 0"
    rpy="0 0 0"
    joint_type="fixed"/>

  <!-- ==== Wheels ==== -->
  <xacro:cylinder_link 
    name="wheel_right"
    radius="${wheel_radius}"
    length="${wheel_width}"
    material="Black"
    mass="${wheel_mass}"
    parent_link="base_link"
    xyz="0 -0.0385 -0.0275"
    rpy="0 0 0"
    joint_type="continuous"
    axis="0 1 0"/>

  <xacro:cylinder_link 
    name="wheel_left"
    radius="${wheel_radius}"
    length="${wheel_width}"
    material="Black"
    mass="${wheel_mass}"
    parent_link="base_link"
    xyz="0 0.0385 -0.0275"
    rpy="0 0 0"
    joint_type="continuous"
    axis="0 1 0"/>

  <!-- ==== Ultrasonic Senors ==== -->
   <xacro:square_link 
    name="ultrasonic_sensor_1"
    size_x="0.0135"
    size_y="0.045"
    size_z="0.0165"
    material="Green"
    mass="0.001"
    parent_link="base_link"
    xyz="0.0485 0 0.0300"
    rpy="0 0 0"
    joint_type="fixed"/>

    <xacro:square_link 
    name="ultrasonic_sensor_2"
    size_x="0.0135"
    size_y="0.045"
    size_z="0.0165"
    material="Green"
    mass="0.001"
    parent_link="base_link"
    xyz="0 -0.0485 0.0300"
    rpy="0 0 4.7123"
    joint_type="fixed"/>
    
    <xacro:square_link 
    name="ultrasonic_sensor_3"
    size_x="0.0135"
    size_y="0.045"
    size_z="0.0165"
    material="Green"
    mass="0.001"
    parent_link="base_link"
    xyz="-0.0485 0 0.0300"
    rpy="0 0 3.14159"
    joint_type="fixed"/>
    
    <xacro:square_link 
    name="ultrasonic_sensor_4"
    size_x="0.0135"
    size_y="0.045"
    size_z="0.0165"
    material="Green"
    mass="0.001"
    parent_link="base_link"
    xyz="0 0.0485 0.0300"
    rpy="0 0 1.5708"
    joint_type="fixed"/>
  
  <!-- ==== Caster Wheels ==== -->
  <xacro:caster_wheel 
    name="front_caster"
    parent_link="base_link"
    pos_x="0.0400" pos_y="0" pos_z="-0.0495"
    color_roll="Yellow"
    color_pitch="Pink"
    color_yaw="Blue"
    length="0.0075"
    radius="0.0075"
    mass="0.0002"/> 

  <xacro:caster_wheel 
    name="back_caster"
    parent_link="base_link"
    pos_x="-0.0400" pos_y="0" pos_z="-0.0495"
    color_roll="Yellow"
    color_pitch="Pink"
    color_yaw="Blue"
    length="0.0075"
    radius="0.0075"
    mass="0.0002"/> 

</robot>